var DEBUGKIT=function(){var a;return{module:function(b){if(this[b]===a){this[b]={};return this[b]}return this[b]}}}();(function(){function versionGTE(a,b){var len=Math.min(a.length,b.length);for(var i=0;i<len;i++){a[i]=parseInt(a[i],10);b[i]=parseInt(b[i],10);if(a[i]>b[i]){return true}if(a[i]<b[i]){return false}}return true}function versionWithin(version,min,max){version=version.split(".");min=min.split(".");max=max.split(".");return versionGTE(version,min)&&versionGTE(max,version)}if(window.jQuery&&versionWithin(jQuery.fn.jquery,"1.8","2.0")){DEBUGKIT.$=window.jQuery}else{var req=new XMLHttpRequest();req.onload=function(){eval(this.responseText);DEBUGKIT.$=jQuery.noConflict(true)};req.open("get",window.DEBUGKIT_JQUERY_URL,false);req.send()}})();DEBUGKIT.loader=function(){return{_startup:[],register:function(a){this._startup.push(a)},init:function(){for(var a=0,b;b=this._startup[a];a++){b.init()}}}}();DEBUGKIT.module("sqlLog");DEBUGKIT.sqlLog=function(){var a=DEBUGKIT.$;return{init:function(){var b=a("#sqllog-tab");var c=b.find("input");var d=function(h){h.preventDefault();var g=a(this.form),i=g.serialize(),f=g.find("input[name*=ds]").val()||"default";var e=a.ajax({url:this.form.action,data:i,type:"POST",success:function(j){a("#sql-log-explain-"+f).html(j)},error:function(){alert("Could not fetch EXPLAIN for query.")}})};c.filter(".sql-explain-link").on("click",d)}}}();DEBUGKIT.loader.register(DEBUGKIT.sqlLog);DEBUGKIT.module("Util");DEBUGKIT.Util.Element={nodeName:function(b,a){return b.nodeName&&b.nodeName.toLowerCase()===a.toLowerCase()},hasClass:function(a,b){if(!a.className){return false}return a.className.indexOf(b)>-1},addClass:function(a,b){if(!a.className){a.className=b;return}a.className=a.className.replace(/^(.*)$/,"$1 "+b)},removeClass:function(a,b){if(DEBUGKIT.Util.isArray(a)){DEBUGKIT.Util.Collection.apply(a,function(c){DEBUGKIT.Util.Element.removeClass(c,b)})}if(!a.className){return false}a.className=a.className.replace(new RegExp(" ?("+b+") ?"),"")},swapClass:function(a,c,b){if(!a.className){return false}a.className=a.className.replace(c,b)},show:function(a){a.style.display="block"},hide:function(a){a.style.display="none"},toggle:function(a){if(a.style.display==="none"){this.show(a);return}this.hide(a)},_walk:function(b,a){var c=b[a];while(true){if(c.nodeType==1){break}c=c[a]}return c},getNext:function(a){return this._walk(a,"nextSibling")},getPrevious:function(a){return this._walk(a,"previousSibling")},height:function(a,b){if(b===undefined){return parseInt(this.getStyle(a,"height"),10)}a.style.height=b+"px"},getStyle:function(a,b){if(a.currentStyle){b=b.replace(/-[a-z]/g,function(c){return c.charAt(1).toUpperCase()});return a.currentStyle[b]}if(window.getComputedStyle){return document.defaultView.getComputedStyle(a,null).getPropertyValue(b)}}};DEBUGKIT.Util.Collection={apply:function(f,g,e){var b,d,c=0,a=f.length;if(a===undefined){for(b in f){d=(e===undefined)?f[b]:e;g.apply(d,[f[b],b])}}else{for(;c<a;c++){d=(e===undefined)?f[c]:e;g.apply(d,[f[c],c])}}}};DEBUGKIT.Util.Event=function(){var d={},b=0;var c=function(){this.returnValue=false};var a=function(){this.cancelBubble=true};var e=function(f){if(!f.preventDefault){f.preventDefault=c}if(!f.stopPropagation){f.stopPropagation=a}if(!f.target){f.target=f.srcElement||document}if(f.pageX===null&&f.clientX!==null){var g=document.body;f.pageX=f.clientX+(g.scrollLeft||0)-(g.clientLeft||0);f.pageY=f.clientY+(g.scrollTop||0)-(g.clientTop||0)}return f};return{addEvent:function(g,i,h,f){f=(f===undefined)?false:f;var j=function(k){k=e(k||window.event);h.apply(g,[k])};if(g.addEventListener){g.addEventListener(i,j,f)}else{if(g.attachEvent){i="on"+i;g.attachEvent(i,j)}else{i="on"+i;g[i]=j}}d[++b]={element:g,type:i,handler:j}},removeEvent:function(f,h,g){if(f.removeEventListener){f.removeEventListener(h,g,false)}else{if(f.detachEvent){h="on"+h;f.detachEvent(h,g)}else{h="on"+h;f[h]=null}}},domready:function(h){if(document.addEventListener){return document.addEventListener("DOMContentLoaded",h,false)}if(document.all&&!window.opera){document.write('<script type="text/javascript" id="__domreadywatcher" defer="defer" src="javascript:void(0)"><\/script>');var f=document.getElementById("__domreadywatcher");f.onreadystatechange=function(){if(this.readyState==="complete"){h()}};f=null;return}if(/Webkit/i.test(navigator.userAgent)){var g=setInterval(function(){if(/loaded|complete/.test(document.readyState)){clearInterval(g);h()}},10)}},unload:function(){var g;for(var f in d){g=d[f];try{this.removeEvent(g.element,g.type,g.handler)}catch(h){}delete d[f]}delete d}}}();DEBUGKIT.Util.Cookie=function(){var a=60;return{write:function(d,e){var c=new Date();c.setTime(c.getTime()+(a*24*60*60*1000));var b="; expires="+c.toGMTString();document.cookie=d+"="+e+b+"; path=/";return true},read:function(d){d=d+"=";var b=document.cookie.split(";");var f=b.length;for(var e=0;e<f;e++){var c=b[e];while(c.charAt(0)===" "){c=c.substring(1,c.length)}if(c.indexOf(d)===0){return c.substring(d.length,c.length)}}return false},del:function(d){var c=new Date();c.setFullYear(2000,0,1);var b=" ; expires="+c.toGMTString();document.cookie=d+"="+b+"; path=/"}}}();DEBUGKIT.Util.merge=function(){var a={};var d=arguments.length;for(var b=0;b<d;b++){var c=arguments[b];for(var e in c){if(c[e]!==undefined){a[e]=c[e]}}}return a};DEBUGKIT.Util.isArray=function(a){return Object.prototype.toString.call(a)==="[object Array]"};DEBUGKIT.Util.Request=function(b){var d={onComplete:function(){},onRequest:function(){},onFail:function(){},method:"GET",async:true,headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"}};var a=this;this.options=DEBUGKIT.Util.merge(d,b);this.options.method=this.options.method.toUpperCase();var c=this.createObj();this.transport=c;this.onComplete=this.options.onComplete;this.onRequest=this.options.onRequest;this.onFail=this.options.onFail;this.send=function(e,g){if(this.options.method==="GET"&&g){e=e+((e.charAt(e.length-1)==="?")?"&":"?")+g;g=null}this.transport.open(this.options.method,e,this.options.async);this.transport.onreadystatechange=function(){a.onReadyStateChange.apply(a,arguments)};for(var f in this.options.headers){this.transport.setRequestHeader(f,this.options.headers[f])}if(typeof g==="object"){g=this.serialize(g)}if(g){this.transport.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}this.onRequest();this.transport.send(g)}};DEBUGKIT.Util.Request.prototype.onReadyStateChange=function(){if(this.transport.readyState!==4){return}if(this.transport.status===200||this.transport.status>300&&this.transport.status<400){this.response={xml:this.transport.responseXML,text:this.transport.responseText};if(typeof this.onComplete==="function"){this.onComplete.apply(this,[this,this.response])}else{return this.response}}else{if(this.transport.status>400){if(typeof this.onFail==="function"){this.onFail.apply(this,[])}else{console.error("Request failed")}}}};DEBUGKIT.Util.Request.prototype.createObj=function(){var d=null;try{d=new XMLHttpRequest()}catch(b){try{d=new ActiveXObject("Msxml2.XMLHTTP")}catch(c){try{d=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){d=null}}}return d};DEBUGKIT.Util.Request.prototype.serialize=function(c){var b="";for(var a in c){if(c.hasOwnProperty(a)){b+=a+"="+c[a]+"&"}}return b.substring(0,b.length-1)};DEBUGKIT.toolbar=function(){var a=DEBUGKIT.Util.Cookie,c=DEBUGKIT.$,b=false;return{elements:{},panels:{},init:function(){var g,f,d,e,h=this;this.elements.toolbar=c("#debug-kit-toolbar");if(this.elements.toolbar.length===0){throw new Error("Toolbar not found, make sure you loaded it.")}this.elements.panel=c("#panel-tabs");this.elements.panel.find(".panel-tab").each(function(k,j){h.addPanel(j)});d=this.elements.toolbar.find(".depth-0");this.makeNeatArray(d);this.deactivatePanel(true)},addPanel:function(f){var e,g,h=this;var d={id:false,element:f,button:undefined,content:undefined,active:false};f=c(f);e=f.children("a");d.id=e.attr("href").replace(/^#/,"");d.button=e;d.content=f.find(".panel-content");if(!d.id||d.content.length===0){return false}this.makePanelDraggable(d);this.makePanelMinMax(d);e.on("click",function(i){i.preventDefault();h.togglePanel(d.id)});this.panels[d.id]=d;return d.id},makePanelDraggable:function(f){var g=null;var e=function(j){j.preventDefault();if(!g){return}var i=g.data("startHeight")+(j.pageY-g.data("startY"));g.parent().height(i)};var h=function(i){g=null;c(document).off("mousemove",e).off("mouseup",h)};var d=function(i){i.preventDefault();g=c(this);g.data("startY",i.pageY);g.data("startHeight",g.parent().height());c(document).on("mousemove",e).on("mouseup",h)};f.content.find(".panel-resize-handle").on("mousedown",d)},makePanelMinMax:function(e){var i;var h=function(){if(!i){i=this.parentNode.offsetHeight}var k=window.innerHeight;var j=k-this.parentNode.offsetTop;c(this.parentNode).height(j);c(this).text("-")};var g=function(){c(this.parentNode).height(i);c(this).text("+");i=null};var f=1;var d=function(j){j.preventDefault();if(f===1){h.call(this);f=0}else{f=1;g.call(this)}};e.content.find(".panel-toggle").on("click",d)},togglePanel:function(d){if(this.panels[d]&&this.panels[d].active){this.deactivatePanel(true)}else{this.deactivatePanel(true);this.activatePanel(d)}},activatePanel:function(g,f){if(this.panels[g]!==undefined&&!this.panels[g].active){var d=this.panels[g];if(d.content.length>0){d.content.css("display","block")}var e=d.content.find(".panel-content-data").height()+70;if(e<=(window.innerHeight/2)){d.content.height(e)}d.button.addClass("active");d.active=true;return true}return false},deactivatePanel:function(f){if(f===true){for(var e in this.panels){this.deactivatePanel(e)}return true}if(this.panels[f]!==undefined){var d=this.panels[f];if(d.content!==undefined){d.content.hide()}d.button.removeClass("active");d.active=false;return true}return false},makeNeatArray:function(d){d.find("ul").hide().parent().addClass("expandable collapsed");d.on("click","li",function(e){e.stopPropagation();c(this).children("ul").toggle().toggleClass("expanded collapsed")})}}}();DEBUGKIT.loader.register(DEBUGKIT.toolbar);DEBUGKIT.module("historyPanel");DEBUGKIT.historyPanel=function(){var e=DEBUGKIT.toolbar,f=DEBUGKIT.$,d;var a=function(g){d.removeClass("loading");f.each(e.panels,function(k,i){if(i.content===undefined||g[k]===undefined){return}var j=i.content.find(".panel-resize-region");if(!j.length){return}var h=j.children();h.filter("div").hide();h.filter(".panel-history").each(function(n,o){var m=o.id.replace("-history","");if(g[m]){o=f(o);o.html(g[m]);var l=o.find(".depth-0");e.makeNeatArray(l)}o.show()})})};var c=function(){var k,h,j,g;d.removeClass("loading");f.each(e.panels,function(l,n){if(l.content===undefined){return}var m=l.content.find(".panel-resize-region");if(!m.length){return}var i=m.children();i.filter("div").show().end().filter(".panel-history").hide()})};function b(g){g.preventDefault();d.removeClass("active");f(this).addClass("active loading");if(this.id==="history-restore-current"){c();return false}var h=f.ajax({url:this.href,type:"GET",dataType:"json"});h.success(a).fail(function(){alert("History retrieval failed")})}return{init:function(){if(e.panels.history===undefined){return}d=e.panels.history.content.find(".history-link");d.on("click",b)}}}();DEBUGKIT.loader.register(DEBUGKIT.historyPanel);DEBUGKIT.toolbarToggle=function(){var c=DEBUGKIT.toolbar,d=DEBUGKIT.$,a=DEBUGKIT.Util.Cookie,b=false;return{init:function(){var g=d("#hide-toolbar"),f=this;g.on("click",function(h){h.preventDefault();f.toggleToolbar()});var e=a.read("toolbarDisplay");if(e!=="show"){b=false;this.toggleToolbar()}},toggleToolbar:function(){var e=b?"show":"hide";d.each(c.panels,function(g,f){d(f.element)[e]();a.write("toolbarDisplay",e)});b=!b;if(b){d("#debug-kit-toolbar").addClass("minimized")}else{d("#debug-kit-toolbar").removeClass("minimized")}return false}}}();DEBUGKIT.loader.register(DEBUGKIT.toolbarToggle);DEBUGKIT.$(document).ready(function(){DEBUGKIT.loader.init()});